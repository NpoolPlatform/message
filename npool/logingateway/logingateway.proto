syntax = "proto3";

package login.gateway.v1;

option go_package = "github.com/NpoolPlatform/message/npool/logingateway";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "npool/npool.proto";
import "npool/appuser/mgr/v1/appusermgr.proto";

service LoginGateway {
    rpc Version (google.protobuf.Empty) returns (npool.v1.VersionResponse){
        option (google.api.http) = {
            post: "/version"
            body: "*"
        };
    }

    rpc Login (LoginRequest) returns (LoginResponse) {
        option (google.api.http) = {
            post: "/v1/login"
            body: "*"
        };
    }
    rpc Logined (LoginedRequest) returns (LoginedResponse) {
        option (google.api.http) = {
            post: "/v1/logined"
            body: "*"
        };
    }
    rpc UpdateCache (UpdateCacheRequest) returns (UpdateCacheResponse) {
        option (google.api.http) = {
            post: "/v1/update/cache"
            body: "*"
        };
    }
    rpc Logout (LogoutRequest) returns (LogoutResponse) {
        option (google.api.http) = {
            post: "/v1/logout"
            body: "*"
        };
    }
    rpc GetLoginHistories (GetLoginHistoriesRequest) returns (GetLoginHistoriesResponse) {
        option (google.api.http) = {
            post: "/v1/get/login/histories"
            body: "*"
        };
    }
}

message LoginRequest {
    string AppID = 10;
    string Account = 20;
    string PasswordHash = 30;
    string ManMachineSpec = 40;
    string EnvironmentSpec = 50;
    string AccountType = 60;
    string Token = 70;
}

message LoginResponse {
    appuser.manager.v1.AppUserInfo Info = 10;
    string Token = 20;
}

message LoginedRequest {
    string AppID = 10;
    string UserID = 20;
    string Token = 70;
}

message LoginedResponse {
    appuser.manager.v1.AppUserInfo Info = 10;
}

message UpdateCacheRequest {
    appuser.manager.v1.AppUserInfo Info = 10;
}

message UpdateCacheResponse {
    appuser.manager.v1.AppUserInfo Info = 10;
}

message LogoutRequest {
    string AppID = 10;
    string UserID = 20;
}

message LogoutResponse {
    appuser.manager.v1.AppUserInfo Info = 10;
}

message LoginHistory {
    string ID = 10;
    string AppID = 20;
    string UserID = 30;
    string ClientIP = 40;
    string UserAgent = 50;
    uint32 CreateAt = 60;
    string Location = 70;
}

message GetLoginHistoriesRequest {
    string AppID = 10;
    string UserID = 20;
    npool.v1.PageInfo PageInfo = 30;
}

message GetLoginHistoriesResponse {
    repeated LoginHistory Infos = 10;
}
