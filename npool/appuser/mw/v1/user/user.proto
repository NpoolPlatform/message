syntax = "proto3";

package appuser.middleware.user.v1;

option go_package = "github.com/NpoolPlatform/message/npool/appuser/mw/v1/user";

import "npool/npool.proto";
import "npool/appuser/mgr/v2/signmethod/signmethod.proto";
import "npool/review/mgr/v2/mgr.proto";
import "npool/appuser/mgr/v2/kyc/kyc.proto";

service Middleware {
    rpc CreateUser        (CreateUserRequest)       returns (CreateUserResponse)       {}
    rpc UpdateUser        (UpdateUserRequest)       returns (UpdateUserResponse)       {}

    rpc GetUsers          (GetUsersRequest)         returns (GetUsersResponse)         {}
    rpc GetUser           (GetUserRequest)          returns (GetUserResponse)          {}
    rpc VerifyUser        (VerifyUserRequest)       returns (VerifyUserResponse)       {}
    rpc GetManyUsers      (GetManyUsersRequest)     returns (GetManyUsersResponse)     {}

    rpc DeleteUser        (DeleteUserRequest)       returns (DeleteUserResponse)       {}

}

message UserReq {
    // Base
    optional string ID                 = 10;
    optional string AppID              = 20;
    optional string EmailAddress       = 30;
    optional string PhoneNO            = 40;

    // Imported
    optional string ImportedFromAppID  = 50;

    // Extra
    optional string Username           = 60;
    repeated string AddressFields      = 70;
    optional string Gender             = 80;
    optional string PostalCode         = 90;
    optional uint32 Age                = 100;
    optional uint32 Birthday           = 110;
    optional string Avatar             = 120;
    optional string Organization       = 130;
    optional string FirstName          = 140;
    optional string LastName           = 150;
    optional string IDNumber           = 160;

    // Control
    optional appuser.manager.signmethod.v2.SignMethodType SigninVerifyType = 170;
    optional bool GoogleAuthVerified   = 180;

    // Secret
    optional string PasswordHash       = 190;
    optional string GoogleSecret       = 200;

    // ThirdParty
    optional string ThirdPartyID       = 210;
    optional string ThirdPartyUserID   = 220;
    optional string ThirdPartyUsername = 230;
    optional string ThirdPartyAvatar   = 240;

    // Banned
    optional bool   Banned             = 250;
    optional string BanMessage         = 260;

    // RoleUser
    repeated string RoleIDs            = 270;
}

message User {
    // Base
    // @inject_tag: sql:"id"
    string          ID                          = 10;
    // @inject_tag: sql:"app_id"
    string          AppID                       = 20;
    // @inject_tag: sql:"email_address"
    string          EmailAddress                = 30;
    // @inject_tag: sql:"phone_no"
    string          PhoneNO                     = 40;

    // Imported
    // @inject_tag: sql:"import_from_app"
    string          ImportedFromAppID           = 50;
    // @inject_tag: sql:"imported_from_app_name"
    string          ImportedFromAppName         = 60;
    // @inject_tag: sql:"imported_from_app_logo"
    string          ImportedFromAppLogo         = 70;
    // @inject_tag: sql:"imported_from_app_home"
    string          ImportedFromAppHome         = 80;

    // Extra
    // @inject_tag: sql:"username"
    string          Username                    = 90;
    // @inject_tag: sql:"address_fields"
    string          AddressFieldsString         = 100;
    repeated string AddressFields               = 110;
    // @inject_tag: sql:"gender"
    string          Gender                      = 120;
    // @inject_tag: sql:"postal_code"
    string          PostalCode                  = 130;
    // @inject_tag: sql:"age"
    uint32          Age                         = 140;
    // @inject_tag: sql:"birthday"
    uint32          Birthday                    = 150;
    // @inject_tag: sql:"avatar"
    string          Avatar                      = 160;
    // @inject_tag: sql:"organization"
    string          Organization                = 170;
    // @inject_tag: sql:"first_name"
    string          FirstName                   = 180;
    // @inject_tag: sql:"last_name"
    string          LastName                    = 190;
    // @inject_tag: sql:"id_number"
    string          IDNumber                    = 200;

    // Control flag
    // @inject_tag: sql:"signin_verify_type"
    string          SigninVerifyTypeStr         = 210;
    appuser.manager.signmethod.v2.SignMethodType SigninVerifyType = 220;
    // @inject_tag: sql:"signin_verify_by_google_authentication"
    int32           SigninVerifyByGoogleAuthInt = 221;
    bool            SigninVerifyByGoogleAuth    = 222;
    // @inject_tag: sql:"google_authentication_verified"
    int32           GoogleAuthVerifiedInt       = 230;
    bool            GoogleAuthVerified          = 240;
    // @inject_tag: sql:"ban_app_user_id"
    string          BanAppUserID                = 250;
    bool            Banned                      = 260;
    // @inject_tag: sql:"ban_message"
    string          BanMessage                  = 270;

    // Secret map
    // @inject_tag: sql:"google_secret"
    string          GoogleSecret                = 280;
    bool            HasGoogleSecret             = 290;

    // Role
    repeated string Roles                       = 300;

    // Login info
    bool            Logined                     = 310;
    string          LoginAccount                = 320;
    appuser.manager.signmethod.v2.SignMethodType LoginAccountType = 330;
    string          LoginToken                  = 340;
    string          LoginClientIP               = 350;
    string          LoginClientUserAgent        = 360;

    // @inject_tag: sql:"created_at"
    uint32          CreatedAt                   = 370;

    optional string InvitationCode              = 380;
    bool            InvitationCodeConfirmed     = 381;
    optional string InvitationCodeID            = 382;
    bool            LoginVerified               = 390;

    // @inject_tag: sql:"kyc_state"
    string          KycStateStr            = 400;
    appuser.manager.kyc.v2.KycState   State = 410;
}

message CreateUserRequest {
    UserReq Info = 10;
}

message CreateUserResponse {
    User Info = 10;
}

message UpdateUserRequest {
    UserReq Info = 10;
}

message UpdateUserResponse {
    User Info = 10;
}

message GetUsersRequest {
    string AppID  = 10;
    int32  Offset = 20;
    int32  Limit  = 30;
}

message GetUsersResponse {
    repeated User Infos = 10;
    uint32 Total  = 40;
}

message GetUserRequest {
    string AppID  = 10;
    string UserID = 20;
}

message GetUserResponse {
    User Info = 10;
}

message VerifyUserRequest {
    string AppID        = 10;
    string Account      = 20;
    appuser.manager.signmethod.v2.SignMethodType AccountType = 30;
    string PasswordHash = 40;
}

message VerifyUserResponse {
    User Info = 10;
}

message GetManyUsersRequest {
    repeated string IDs = 10;
}

message GetManyUsersResponse {
    repeated User Infos = 10;
    uint32 Total  = 40;
}

message DeleteUserRequest {
    string ID = 10;
}

message DeleteUserResponse {
}
