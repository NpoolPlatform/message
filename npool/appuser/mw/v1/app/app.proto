syntax = "proto3";

package appuser.middleware.app.v1;

option go_package = "github.com/NpoolPlatform/message/npool/appuser/mw/v1/app";

import "npool/appuser/mgr/v2/app/app.proto";
import "npool/appuser/mgr/v2/signmethod/signmethod.proto";
import "npool/appuser/mgr/v2/recaptcha/recaptcha.proto";

service AppMw {
    rpc CreateApp              (CreateAppRequest)             returns (CreateAppResponse)             {}
    rpc UpdateApp              (UpdateAppRequest)             returns (UpdateAppResponse)             {}
    rpc GetApp                 (GetAppRequest)                returns (GetAppResponse)                {}
    rpc GetApps                (GetAppsRequest)               returns (GetAppsResponse)               {}
    rpc GetUserApps            (GetUserAppsRequest)           returns (GetUserAppsResponse)           {}

    rpc BanApp                 (BanAppRequest)                returns (BanAppResponse)                {}
    rpc GetSignMethods         (GetSignMethodsRequest)        returns (GetSignMethodsResponse)        {}
    rpc SetSignMethods         (SetSignMethodsRequest)        returns (SetSignMethodsResponse)        {}
    rpc GetRecaptchas          (GetRecaptchasRequest)         returns (GetRecaptchasResponse)         {}
    rpc SetRecaptcha           (SetRecaptchaRequest)          returns (SetRecaptchaResponse)          {}
    rpc SetKyc                 (SetKycRequest)                returns (SetKycResponse)                {}
    rpc SetSigninVerify        (SetSigninVerifyRequest)       returns (SetSigninVerifyResponse)       {}
    rpc SetInvitationCodeMust  (SetInvitationCodeMustRequest) returns (SetInvitationCodeMustResponse) {}
}

message App {
    // Base info
    string          ID                 = 10;
    string          CreatedBy          = 20;
    string          Name               = 30;
    string          Logo               = 40;
    string          Description        = 50;

    // Banned
    bool            Banned             = 60;
    string          BanAppID           = 70;
    string          BanMessage         = 80;

    // Sign methods
    repeated string SignupMethods      = 90;
    repeated string ExtSigninMethods   = 100;

    // Control flag
    string          RecaptchaMethod    = 110;
    bool            KycEnable          = 120;
    bool            SigninVerifyEnable = 130;
    bool            InvitationCodeMust = 140;

    string          CreateAt           = 150;
}

// Here when we refer ID in request, it always app.ID

message CreateAppRequest {
    appuser.manager.app.v2.AppReq Info = 10;
}

message CreateAppResponse {
    App Info = 10;
}

message UpdateAppRequest {
    appuser.manager.app.v2.AppReq Info = 10;
}

message UpdateAppResponse {
    App Info = 10;
}

message GetAppRequest {
    string ID = 10;
}

message GetAppResponse {
    App Info = 10;
}

message GetAppsRequest {
    int32 Offset = 10;
    int32 Limit  = 20;
}

message GetAppsResponse {
    repeated App Infos = 10;
    uint32       Total = 20;
}

message GetUserAppsRequest {
    string UserID = 10;
    int32  Offset = 20;
    int32  Limit  = 30;
}

message GetUserAppsResponse {
    repeated App Infos = 10;
    uint32       Total = 20;
}

message BanAppRequest {
    string ID         = 10;
    string BanMessage = 20;
}

message BanAppResponse {
    App Info = 10;
}

message GetSignMethodsRequest {
}

message GetSignMethodsResponse {
    // In future this may be put to database then admin can change it
    repeated appuser.manager.signmethod.v2.SignMethod Infos = 10;
}

message SetSignMethodsRequest {
    string          ID            = 10;
    repeated string SignMethodIDs = 20;
}

message SetSignMethodsResponse {
    App Info = 10;
}

message GetRecaptchasRequest {
}

message GetRecaptchasResponse {
    // In future this may be put to database then admin can change it
    repeated appuser.manager.recaptcha.v2.Recaptcha Infos = 10;
}

message SetRecaptchaRequest {
    string ID          = 10;
    string RecaptchaID = 20;
}

message SetRecaptchaResponse {
    App Info = 10;
}

message SetKycRequest {
    string ID     = 10;
    bool   Enable = 20;
}

message SetKycResponse {
    App Info = 10;
}

message SetSigninVerifyRequest {
    string ID     = 10;
    bool   Enable = 20;
}

message SetSigninVerifyResponse {
    App Info = 10;
}

message SetInvitationCodeMustRequest {
    string ID     = 10;
    bool   Enable = 20;
}

message SetInvitationCodeMustResponse {
    App Info = 10;
}
