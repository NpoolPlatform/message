syntax = "proto3";

package notif.middleware.announcement.v1;

option go_package = "github.com/NpoolPlatform/message/npool/notif/mw/v1/announcement";

import "npool/basetypes/v1/conds.proto";
import "npool/basetypes/v1/channel.proto";

// Service Name
service Middleware {
    rpc GetAnnouncements       (GetAnnouncementsRequest)       returns (GetAnnouncementsResponse)       {}
    rpc CreateAnnouncement     (CreateAnnouncementRequest)     returns (CreateAnnouncementResponse)     {}
    rpc UpdateAnnouncement     (UpdateAnnouncementRequest)     returns (UpdateAnnouncementResponse)     {}
    rpc GetAnnouncement        (GetAnnouncementRequest)        returns (GetAnnouncementResponse)        {}
    rpc GetAnnouncementOnly    (GetAnnouncementOnlyRequest)    returns (GetAnnouncementOnlyResponse)    {}
    rpc ExistAnnouncement      (ExistAnnouncementRequest)      returns (ExistAnnouncementResponse)      {}
    rpc ExistAnnouncementConds (ExistAnnouncementCondsRequest) returns (ExistAnnouncementCondsResponse) {}
    rpc CountAnnouncements     (CountAnnouncementsRequest)     returns (CountAnnouncementsResponse)     {}
    rpc DeleteAnnouncement     (DeleteAnnouncementRequest)     returns (DeleteAnnouncementResponse)     {}
}

enum AnnouncementType {
    DefaultType   = 0;
    Broadcast     = 10;
    Multicast     = 20;
}

message AnnouncementReq {
    optional string ID         = 10;
    optional string AppID      = 20;
    optional string LangID     = 30;
    optional string Title      = 40;
    optional string Content    = 50;
    optional basetypes.v1.NotifChannel Channel = 60;
    optional uint32 EndAt      = 70;
    optional AnnouncementType AnnouncementType = 80;
}

message Announcement {
    // @inject_tag: sql:"id"
    string ID         = 10;
    // @inject_tag: sql:"app_id"
    string AppID      = 20;
    // @inject_tag: sql:"lang_id"
    string LangID     = 30;
    // @inject_tag: sql:"title"
    string Title      = 40;
    // @inject_tag: sql:"content"
    string Content    = 50;
    // @inject_tag: sql:"channel"
    string ChannelStr = 59;
    basetypes.v1.NotifChannel Channel = 60;
    // @inject_tag: sql:"end_at"
    uint32 EndAt      = 70;
    // @inject_tag: sql:"type"
    string AnnouncementTypeStr = 79;
    AnnouncementType AnnouncementType = 80;
    // @inject_tag: sql:"created_at"
    uint32 CreatedAt  = 90;
    // @inject_tag: sql:"updated_at"
    uint32 UpdatedAt  = 100;
}

message Conds {
    optional basetypes.v1.StringVal      ID               = 9;
    optional basetypes.v1.StringVal      AppID            = 10;
    optional basetypes.v1.StringVal      UserID           = 20;
    optional basetypes.v1.StringVal      LangID           = 30;
    optional basetypes.v1.BoolVal        Read             = 50;
    optional basetypes.v1.Uint32Val      AnnouncementType = 60;
    optional basetypes.v1.BoolVal        Notified         = 80;
    optional basetypes.v1.Uint32Val      EndAt            = 90;
    optional basetypes.v1.Uint32Val      Channel          = 100;
}

message CreateAnnouncementRequest {
    AnnouncementReq Info = 10;
}

message CreateAnnouncementResponse {
    Announcement Info = 10;
}

message UpdateAnnouncementRequest {
    AnnouncementReq Info = 10;
}

message UpdateAnnouncementResponse {
    Announcement Info = 10;
}

message GetAnnouncementRequest {
    string ID = 10;
}

message GetAnnouncementResponse {
    Announcement Info = 10;
}

message GetAnnouncementsRequest {
    Conds Conds   = 10;
    int32 Offset  = 20;
    int32 Limit   = 30;
}

message GetAnnouncementsResponse {
    repeated Announcement Infos = 10;
    uint32                Total = 20;
}

message GetAnnouncementOnlyRequest {
    Conds Conds = 10;
}

message GetAnnouncementOnlyResponse {
    Announcement Info = 10;
}

message ExistAnnouncementRequest {
    string ID = 10;
    string AppID = 20;
}

message ExistAnnouncementResponse {
    bool Info = 10;
}

message ExistAnnouncementCondsRequest {
    Conds Conds = 10;
}

message ExistAnnouncementCondsResponse {
    bool Info = 10;
}

message CountAnnouncementsRequest {
    Conds Conds = 10;
}

message CountAnnouncementsResponse {
    uint32 Info = 10;
}

message DeleteAnnouncementRequest {
    AnnouncementReq Info = 10;
}

message DeleteAnnouncementResponse {
    Announcement Info = 10;
}
