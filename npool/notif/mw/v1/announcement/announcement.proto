syntax = "proto3";

package notif.middleware.announcement.announcement.v1;

option go_package = "github.com/NpoolPlatform/message/npool/notif/mw/v1/announcement";

import "npool/notif/mgr/v1/announcement/announcement.proto";
import "npool/notif/mgr/v1/channel/channel.proto";
import "npool/npool.proto";

// Service Name
service Middleware {
    rpc GetAnnouncementStates (GetAnnouncementStatesRequest) returns (GetAnnouncementStatesResponse) {}
    rpc GetAnnouncements      (GetAnnouncementsRequest)      returns (GetAnnouncementsResponse)      {}
}

message Conds {
    optional npool.v1.StringVal      AppID          = 20;
    optional npool.v1.StringVal      UserID         = 30;
    optional npool.v1.StringVal      AnnouncementID = 40;
    optional npool.v1.Uint32Val      Channel        = 50;
    optional npool.v1.Uint32Val      EndAt          = 60;
    optional npool.v1.BoolVal        AlreadySend    = 70;
    optional npool.v1.StringSliceVal UserIDs        = 80;
    optional npool.v1.BoolVal        AlreadyRead    = 90;
}

message Announcement {
    // @inject_tag: sql:"announcement_id"
    string AnnouncementID = 10;
    // @inject_tag: sql:"app_id"
    string AppID          = 20;
    // @inject_tag: sql:"user_id"
    string UserID         = 30;
    // @inject_tag: sql:"title"
    string Title          = 40;
    // @inject_tag: sql:"content"
    string Content        = 50;
    // @inject_tag: sql:"channel"
    string ChannelStr     = 60;
    notif.manager.channel.v1.NotifChannel Channel = 61;
    bool  AlreadySend     = 70;
    // @inject_tag: sql:"created_at"
    uint32 CreatedAt      = 90;
    // @inject_tag: sql:"updated_at"
    uint32 UpdatedAt      = 100;
    // @inject_tag: sql:"read_user_id"
    string ReadUserID     = 110;
    bool   AlreadyRead    = 120;
    // @inject_tag: sql:"end_at"
    uint32 EndAt          = 130;
}

message GetAnnouncementStatesRequest {
    Conds Conds = 10;
    int32 Offset = 20;
    int32 Limit  = 30;
}

message GetAnnouncementStatesResponse {
    repeated Announcement Infos = 10;
    uint32   Total              = 20;
}

message GetAnnouncementsRequest {
    notif.manager.announcement.v1.Conds Conds = 10;
    int32 Offset = 20;
    int32 Limit  = 30;
}

message GetAnnouncementsResponse {
    repeated Announcement Infos = 10;
    uint32                Total  = 20;
}