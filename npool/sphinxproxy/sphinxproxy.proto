syntax = "proto3";

package sphinx.proxy.v1;

option go_package = "github.com/NpoolPlatform/message/npool/sphinxproxy";

import "npool/sphinxplugin/sphinxplugin.proto";

// Service Name
service SphinxProxy {
    // sync
    rpc GetBalance (GetBalanceRequest) returns (GetBalanceReponse) {}
    rpc CreateWallet (CreateWalletRequest) returns (CreateWalletReponse) {}
    rpc CreateTransaction (CreateTransactionRequest) returns (CreateTransactionReponse) {}
    rpc GetTransaction (GetTransactionRequest) returns (GetTransactionReponse) {}

    // async stream
    rpc ProxyPlugin (stream ProxyPluginResponse) returns (stream ProxyPluginRequest) {}
    rpc ProxySign (stream ProxySignResponse) returns (stream ProxySignRequest) {}
}

message GetBalanceRequest {
    sphinx.plugin.v1.CoinType CoinType = 100;
    string Address                     = 110;
}

message BalanceInfo {
    double Balance  = 100;
}

message GetBalanceReponse {
    BalanceInfo Info = 100;
}

message CreateWalletRequest {
    sphinx.plugin.v1.CoinType CoinType = 100;
}

message WalletInfo {
    string Address = 100;
    // TODO sign type
}

message CreateWalletReponse {
    WalletInfo Info = 100;
}

message CreateTransactionRequest {
    sphinx.plugin.v1.CoinType CoinType  = 100;
	string TransactionID                = 110;
	string From                         = 130;
	string To                           = 140;
    double Value                        = 120;
}

message CreateTransactionReponse {

}

message GetTransactionRequest {

}

message GetTransactionReponse {

}

// RegisterCoin ..
message ProxyPluginResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    uint64 Nonce                                = 130;
    string CID                                  = 140;
    double Balance                              = 150;
    sphinx.plugin.v1.UnsignedMessage Message    = 160;
}

// MpoolGetNonce WalletBalance MpoolPush ..
message ProxyPluginRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    string Address                              = 130;
    sphinx.plugin.v1.UnsignedMessage Message    = 140;
    sphinx.plugin.v1.Signature       Signature  = 150;
}

// Sign WalletNew ..
message ProxySignRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    sphinx.plugin.v1.UnsignedMessage Message    = 130;
}

message ProxySignResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    ProxySignResponseInfo Info                  = 130;
}

message ProxySignResponseInfo {
    string Address                              = 100;// create new account address
    sphinx.plugin.v1.UnsignedMessage Message    = 110;
	sphinx.plugin.v1.Signature       Signature  = 120;
}

enum TransactionType {
    Invalid         = 0;
    WalletNew       = 1; // proxy -> sign
    TransactionNew  = 2;
    Signature       = 3; // proxy -> sign
    Balance         = 4; // proxy -> plugin
    PreSign         = 5; // proxy -> pluign get nonce
    Broadcast       = 6; // proxy -> plugin mpool push
    RegisterCoin    = 7; // plugin -> proxy
}
