syntax = "proto3";

package sphinx.proxy.v1;

option go_package = "github.com/NpoolPlatform/message/npool/sphinxproxy";

import "npool/sphinxplugin/sphinxplugin.proto";

// Service Name
service SphinxProxy {
    // sync
    rpc GetBalance (GetBalanceRequest) returns (GetBalanceResponse) {}
    rpc CreateWallet (CreateWalletRequest) returns (CreateWalletResponse) {}
    rpc CreateTransaction (CreateTransactionRequest) returns (CreateTransactionResponse) {}
    rpc GetTransaction (GetTransactionRequest) returns (GetTransactionResponse) {}

    // async stream
    rpc ProxyPlugin (stream ProxyPluginResponse) returns (stream ProxyPluginRequest) {}
    rpc ProxySign (stream ProxySignResponse) returns (stream ProxySignRequest) {}
}

message GetBalanceRequest {
    string Name     = 100;
    string Address  = 110;
}

message BalanceInfo {
    double Balance      = 100;
    string BalanceStr   = 110;
}

message GetBalanceResponse {
    BalanceInfo Info = 100;
}

message CreateWalletRequest {
    string Name = 100;
}

message WalletInfo {
    string Address = 100;
    // TODO sign type
}

message CreateWalletResponse {
    WalletInfo Info = 100;
}

message CreateTransactionRequest {
    string Name             = 100;
    string TransactionID    = 110;
    string From             = 130;
    string To               = 140;
    double Value            = 120;
}

message CreateTransactionResponse {

}

message GetTransactionRequest {
    string TransactionID    = 100;
}

message TransactionChainInfo {
    string CID      = 100;
    int64 ExitCode  = 110;
    string State    = 120; // "wait", "sign", "sync", "done", "fail"
}

message GetTransactionResponse {
    TransactionChainInfo Info = 100;
}

// RegisterCoin ..
message ProxyPluginResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    uint64 Nonce                                = 130;
    string CID                                  = 140;
    double Balance                              = 150;
    string BalanceStr                           = 160;
    sphinx.plugin.v1.UnsignedMessage Message    = 170;
    int64  ExitCode                             = 180; // -1 find cid state on chain internal server error
}

// MpoolGetNonce WalletBalance MpoolPush ..
message ProxyPluginRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    string Address                              = 130;
    sphinx.plugin.v1.UnsignedMessage Message    = 140;
    sphinx.plugin.v1.Signature       Signature  = 150;
    string CID                                  = 160;
}

// Sign WalletNew ..
message ProxySignRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    sphinx.plugin.v1.UnsignedMessage Message    = 130;
}

message ProxySignResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string TransactionID                        = 120;
    ProxySignResponseInfo Info                  = 130;
}

message ProxySignResponseInfo {
    string Address                              = 100;// create new account address
    sphinx.plugin.v1.UnsignedMessage Message    = 110;
	sphinx.plugin.v1.Signature       Signature  = 120;
}

enum TransactionType {
    Invalid         = 0;
    WalletNew       = 1; // proxy -> sign
    TransactionNew  = 2;
    Signature       = 3; // proxy -> sign
    Balance         = 4; // proxy -> plugin
    PreSign         = 5; // proxy -> pluign get nonce
    Broadcast       = 6; // proxy -> plugin mpool push
    RegisterCoin    = 7; // plugin -> proxy
    SyncMsgState    = 8; // plugin -> proxy
}
