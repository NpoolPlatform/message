syntax = "proto3";

package order.middleware.fee.v1;

option go_package = "github.com/NpoolPlatform/message/npool/order/mw/v1/fee";

import "google/api/annotations.proto";
import "npool/basetypes/order/v1/enums.proto";
import "npool/basetypes/good/v1/enums.proto";
import "npool/basetypes/v1/conds.proto";
import "npool/order/mw/v1/payment/payment.proto";
import "npool/order/mw/v1/order/coupon/coupon.proto";
import "npool/order/mw/v1/order/order.proto";

// Service Name
service Middleware {
    rpc CreateFeeOrder (CreateFeeOrderRequest) returns (CreateFeeOrderResponse) {}
    rpc CreateFeeOrders (CreateFeeOrdersRequest) returns (CreateFeeOrdersResponse) {}
    rpc UpdateFeeOrder (UpdateFeeOrderRequest) returns (UpdateFeeOrderResponse) {}
    rpc GetFeeOrder (GetFeeOrderRequest) returns (GetFeeOrderResponse) {}
    rpc GetFeeOrders (GetFeeOrdersRequest) returns (GetFeeOrdersResponse) {}
    rpc CountFeeOrders (CountFeeOrdersRequest) returns (CountFeeOrdersResponse) {}
    rpc ExistFeeOrder (ExistFeeOrderRequest) returns (ExistFeeOrderResponse) {}
    rpc ExistFeeOrderConds (ExistFeeOrderCondsRequest) returns (ExistFeeOrderCondsResponse) {}
    rpc DeleteFeeOrder (DeleteFeeOrderRequest) returns (DeleteFeeOrderResponse) {}
    rpc DeleteFeeOrders (DeleteFeeOrdersRequest) returns (DeleteFeeOrdersResponse) {}
}

message FeeOrderReq {
    // Order base
    optional uint32 ID = 10;
    optional string EntID = 20;
    optional string AppID = 30;
    optional string UserID = 40;
    optional string GoodID = 50;
    optional basetypes.good.v1.GoodType GoodType = 60;
    optional string AppGoodID = 70;
    optional string OrderID = 80;
    optional string ParentOrderID = 90; // It's must for fee order
    optional basetypes.order.v1.OrderType OrderType = 100;
    optional basetypes.order.v1.PaymentType PaymentType = 110;
    optional basetypes.order.v1.OrderCreateMethod CreateMethod = 120;

    // Power rental
    optional string GoodValueUSD = 220;
    optional string PaymentAmountUSD = 230;
    optional string DiscountAmountUSD = 240;
    optional string PromotionID = 250;
    optional uint32 DurationSeconds = 260;

    // Order state base
    optional basetypes.order.v1.OrderState OrderState = 300;

    // Power rental state
    optional bool UserSetPaid = 410;
    optional bool UserSetCanceled = 420;
    optional bool AdminSetCanceled = 430;
    optional basetypes.order.v1.PaymentState PaymentState = 440;

    // Work flow and lock
    optional bool Rollback = 500;
    optional string LedgerLockID = 510;
    optional string PaymentID = 520;

    // Coupons
    repeated string CouponIDs = 600;
    // Payment balances
    repeated order.middleware.payment.v1.PaymentBalanceReq PaymentBalances = 610;
    // Payment transfers
    repeated order.middleware.payment.v1.PaymentTransferReq PaymentTransfers = 620;
}

message FeeOrder {
    // Base order information
    // @inject_tag: sql:"id"
    uint32 ID = 10;
    // @inject_tag: sql:"ent_id"
    string EntID = 20;
    // @inject_tag: sql:"app_id"
    string AppID = 30;
    // @inject_tag: sql:"user_id"
    string UserID = 40;
    // @inject_tag: sql:"good_id"
    string GoodID = 50;
    // @inject_tag: sql:"good_type"
    string GoodTypeStr = 60;
    basetypes.good.v1.GoodType GoodType = 70;
    // @inject_tag: sql:"app_good_id"
    string AppGoodID = 80;
    // @inject_tag: sql:"order_id"
    string OrderID = 90;
    // @inject_tag: sql:"parent_order_id"
    string ParentOrderID = 100;
    // @inject_tag: sql:"parent_good_id"
    string ParentGoodID = 110;
    // @inject_tag: sql:"parent_app_good_id"
    string ParentAppGoodID = 120;
    // @inject_tag: sql:"parent_good_type"
    string ParentGoodTypeStr = 130;
    basetypes.good.v1.GoodType ParentGoodType = 140;
    // @inject_tag: sql:"order_type"
    string OrderTypeStr = 150;
    basetypes.order.v1.OrderType OrderType = 160;
    // @inject_tag: sql:"payment_type"
    string PaymentTypeStr = 170;
    basetypes.order.v1.PaymentType PaymentType = 180;
    // @inject_tag: sql:"create_method"
    string CreateMethodStr = 190;
    basetypes.order.v1.OrderCreateMethod CreateMethod = 200;

    // Base order state information
    // @inject_tag: sql:"order_state"
    string OrderStateStr = 250;
    basetypes.order.v1.OrderState OrderState = 260;

    // Power rental information
    // @inject_tag: sql:"good_value_usd"
    string GoodValueUSD = 300;
    // @inject_tag: sql:"payment_good_value_usd"
    string PaymentGoodValueUSD = 310;
    // @inject_tag: sql:"payment_amount_usd"
    string PaymentAmountUSD = 320;
    // @inject_tag: sql:"discount_amount_usd"
    string DiscountAmountUSD = 330;
    // @inject_tag: sql:"promotion_id"
    string PromotionID = 340;
    // @inject_tag: sql:"duration_seconds"
    uint32 DurationSeconds = 350;

    // Power rental state information
    // @inject_tag: sql:"cancel_state"
    string CancelStateStr = 400;
    basetypes.order.v1.OrderState CancelState = 410;
    // @inject_tag: sql:"canceled_at"
    uint32 CanceledAt = 420;
    // @inject_tag: sql:"paid_at"
    uint32 PaidAt = 430;
    // @inject_tag: sql:"user_set_paid"
    bool UserSetPaid = 440;
    // @inject_tag: sql:"user_set_canceled"
    bool UserSetCanceled = 450;
    // @inject_tag: sql:"admin_set_canceled"
    bool AdminSetCanceled = 460;
    // @inject_tag: sql:"payment_state"
    string PaymentStateStr = 470;
    basetypes.order.v1.PaymentState PaymentState = 480;
    // @inject_tag: sql:"ledger_lock_id"
    string LedgerLockID = 490;
    // @inject_tag: sql:"payment_id"
    string PaymentID = 500;

    // Coupons
    repeated order.middleware.order1.coupon.v1.OrderCouponInfo Coupons = 600;
    // Payment balances
    repeated order.middleware.payment.v1.PaymentBalanceInfo PaymentBalances = 610;
    // Payment transfers
    repeated order.middleware.payment.v1.PaymentTransferInfo PaymentTransfers = 620;

    // @inject_tag: sql:"created_at"
    uint32 CreatedAt = 1000;
    // @inject_tag: sql:"updated_at"
    uint32 UpdatedAt = 1010;
}

message FeeDuration {
    // @inject_tag: sql:"parent_order_id"
    string ParentOrderID = 10;
    // @inject_tag: sql:"app_good_id"
    string AppGoodID = 20;
    // @inject_tag: sql:"total_duration_seconds"
    uint32 TotalDurationSeconds = 30;
}

message Conds {
    // order
    optional basetypes.v1.Uint32Val ID = 10;
    optional basetypes.v1.Uint32SliceVal IDs = 20;
    optional basetypes.v1.StringVal EntID = 30;
    optional basetypes.v1.StringSliceVal EntIDs = 40;
    optional basetypes.v1.StringVal OrderID = 50;
    optional basetypes.v1.StringSliceVal OrderIDs = 60;
    optional basetypes.v1.StringVal AppID = 70;
    optional basetypes.v1.StringVal UserID = 80;
    optional basetypes.v1.StringVal GoodID = 90;
    optional basetypes.v1.StringSliceVal GoodIDs = 100;
    optional basetypes.v1.StringVal AppGoodID = 110;
    optional basetypes.v1.StringSliceVal AppGoodIDs = 120;
    optional basetypes.v1.StringVal ParentOrderID = 130;
    optional basetypes.v1.StringSliceVal ParentOrderIDs = 140;
    optional basetypes.v1.Uint32Val OrderType = 150;
    optional basetypes.v1.Uint32Val PaymentType = 160;
    optional basetypes.v1.Uint32SliceVal PaymentTypes = 170;

    // orderstate
    optional basetypes.v1.Uint32Val OrderState = 200;
    optional basetypes.v1.Uint32SliceVal OrderStates = 210;

    // power rental
    optional basetypes.v1.BoolVal UserSetCanceled = 300;
    optional basetypes.v1.BoolVal AdminSetCanceled = 310;

    // power rental state
    optional basetypes.v1.Uint32Val PaymentState = 400;
    optional basetypes.v1.Uint32SliceVal PaymentStates = 410;

    // coupon
    optional basetypes.v1.StringVal CouponID = 500;
    optional basetypes.v1.StringSliceVal CouponIDs = 510;

    // other
    optional basetypes.v1.Uint32Val CreatedAt = 600;
    optional basetypes.v1.Uint32Val UpdatedAt = 610;
    optional basetypes.v1.Uint32Val PaidAt = 620;
}

message CreateFeeOrderRequest {
    FeeOrderReq Info = 10;
}

message CreateFeeOrderResponse {
    FeeOrder Info = 10;
}

message CreateFeeOrdersRequest {
    repeated FeeOrderReq Infos = 10;
}

message CreateFeeOrdersResponse {
    repeated FeeOrder Infos = 10;
}

message UpdateFeeOrderRequest {
    FeeOrderReq Info = 10;
}

message UpdateFeeOrderResponse {
    FeeOrder Info = 10;
}

message GetFeeOrderRequest {
    string OrderID = 10;
}

message GetFeeOrderResponse {
    FeeOrder Info = 10;
}

message GetFeeOrdersRequest {
    Conds Conds = 10;
    int32 Offset = 20;
    int32 Limit = 30;
}

message GetFeeOrdersResponse {
    repeated FeeOrder Infos = 10;
    uint32 Total = 20;
}

message CountFeeOrdersRequest {
    Conds Conds = 10;
}

message CountFeeOrdersResponse {
    uint32 Info = 10;
}

message ExistFeeOrderRequest {
    string OrderID = 10;
}

message ExistFeeOrderResponse {
    bool Info = 10;
}

message ExistFeeOrderCondsRequest {
    Conds Conds = 10;
}

message ExistFeeOrderCondsResponse {
    bool Info = 10;
}

message DeleteFeeOrderRequest {
    FeeOrderReq Info = 10;
}

message DeleteFeeOrderResponse {
    FeeOrder Info = 10;
}

message DeleteFeeOrdersRequest {
    repeated FeeOrderReq Infos = 10;
}

message DeleteFeeOrdersResponse {
    repeated FeeOrder Infos = 10;
}

