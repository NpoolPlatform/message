syntax = "proto3";

package order.middleware.order1.v1;

option go_package = "github.com/NpoolPlatform/message/npool/order/mw/v1/order";

import "npool/basetypes/order/v1/enums.proto";
import "npool/basetypes/v1/conds.proto";


// Service Name
service Middleware {
    rpc CreateOrder     (CreateOrderRequest)    returns (CreateOrderResponse)    {}
    rpc CreateOrders    (CreateOrdersRequest)   returns (CreateOrdersResponse)    {}
    rpc UpdateOrder     (UpdateOrderRequest)    returns (UpdateOrderResponse)    {}
    rpc UpdateOrders    (UpdateOrdersRequest)   returns (UpdateOrdersResponse)   {}
    rpc GetOrder        (GetOrderRequest)       returns (GetOrderResponse)       {}
    rpc GetOrders       (GetOrdersRequest)      returns (GetOrdersResponse)      {}
    rpc GetOrderOnly    (GetOrderOnlyRequest)   returns (GetOrderOnlyResponse)   {}
    rpc CountOrders     (CountOrdersRequest)    returns (CountOrdersResponse)    {}
    rpc SumOrderUnits   (SumOrderUnitsRequest)  returns (SumOrderUnitsResponse)  {}
    rpc ExistOrder      (ExistOrderRequest)      returns (ExistOrderResponse)      {}
    rpc ExistOrderConds (ExistOrderCondsRequest) returns (ExistOrderCondsResponse) {}
    rpc DeleteOrder     (DeleteOrderRequest)     returns (DeleteOrderResponse)     {}
}

message OrderReq {
    // order
    optional string AppID                     = 10;
    optional string UserID                    = 20;
    optional string GoodID                    = 30;
    optional string AppGoodID                 = 40;
    optional string ParentOrderID             = 50;
    optional string Units                     = 60;
    optional string GoodValue                 = 70;
    optional string PaymentAmount             = 80;
    optional string DiscountAmount            = 90;
    optional string PromotionID               = 100;
    optional uint32 StartAt                   = 110;
    optional basetypes.order.v1.OrderStartMode StartMode = 120;
    optional uint32 DurationDays                         = 130;
    optional basetypes.order.v1.OrderType OrderType      = 140;
    optional basetypes.order.v1.InvestmentType InvestmentType = 150;
    repeated string CouponIDs                                 = 160;
    optional basetypes.order.v1.PaymentType PaymentType     = 170;

    // payment
    optional string PaymentAccountID          = 180;
    optional string PaymentCoinInfoID         = 190;
    optional string PaymentStartAmount        = 200;
    optional string PaymentTransferAmount     = 210;
    optional string PaymentBalanceAmount      = 220;
    optional string PaymentCoinUSDCurrency    = 230;
    optional string PaymentLocalUSDCurrency   = 240;
    optional string PaymentLiveUSDCurrency    = 250;

    // Create or Update
    // orderstate
    optional basetypes.order.v1.OrderState OrderState   = 290;
    optional uint32 EndAt                               = 300;
    optional uint32 LastBenefitAt                       = 310;
    optional basetypes.order.v1.BenefitState BenefitState = 320;
    optional bool   UserSetPaid                           = 330;
    optional bool   UserSetCanceled                       = 340;
    optional string PaymentTransactionID                  = 350;
    optional string PaymentFinishAmount                   = 360;
    optional basetypes.order.v1.PaymentState PaymentState = 370;

    // Only in update
    optional string ID                        = 260;
    optional string PaymentID                 = 270;
    optional string OrderStateID              = 280;
}

message Order {
    // order
    // @inject_tag: sql:"id"
    string ID                                        = 10;
    // @inject_tag: sql:"app_id"
    string AppID                                     = 20;
    // @inject_tag: sql:"user_id"
    string UserID                                    = 30;
    // @inject_tag: sql:"good_id"
    string GoodID                                    = 40;
    // @inject_tag: sql:"app_good_id"
    string AppGoodID                                 = 50;
    // @inject_tag: sql:"payment_id"
    string PaymentID                                 = 60;
    // @inject_tag: sql:"parent_order_id"
    string ParentOrderID                             = 70;
    // @inject_tag: sql:"units_v1"
    string Units                                     = 80;
    // @inject_tag: sql:"good_value"
    string GoodValue                                 = 90;
    // @inject_tag: sql:"payment_amount"
    string PaymentAmount                             = 100;
    // @inject_tag: sql:"discount_amount"
    string DiscountAmount                            = 110;
    // @inject_tag: sql:"promotion_id"
    string PromotionID                               = 120;
    // @inject_tag: sql:"start_at"
    uint32 StartAt                                   = 130;
    // @inject_tag: sql:"start_mode"
    string StartModeStr                              = 140;
    basetypes.order.v1.OrderStartMode StartMode      = 150;
    // @inject_tag: sql:"duration_days"
    uint32 DurationDays                              = 160;
    // @inject_tag: sql:"order_type"
    string OrderTypeStr                              = 170;
    basetypes.order.v1.OrderType OrderType           = 180;
    // @inject_tag: sql:"investment_type"
    string InvestmentTypeStr                         = 190;
    basetypes.order.v1.InvestmentType InvestmentType = 200;
    // @inject_tag: sql:"coupon_ids"
    string CouponIDsStr                              = 210;
    repeated string  CouponIDs                       = 220;
    // @inject_tag: sql:"payment_type"
    string PaymentTypeStr                            = 230;
    basetypes.order.v1.PaymentType PaymentType       = 240;

    // payment
    // @inject_tag: sql:"payment_account_id"
    string PaymentAccountID                      = 250;
    // @inject_tag: sql:"payment_coin_info_id"
    string PaymentCoinInfoID                     = 260;
    // @inject_tag: sql:"payment_start_amount"
    string PaymentStartAmount                    = 270;
    // @inject_tag: sql:"payment_transfer_amount"
    string PaymentTransferAmount                 = 280;
    // @inject_tag: sql:"payment_balance_amount"
    string PaymentBalanceAmount                  = 290;
    // @inject_tag: sql:"payment_coin_usd_currency"
    string PaymentCoinUSDCurrency                = 300;
    // @inject_tag: sql:"payment_local_coin_usd_currency"
    string PaymentLocalUSDCurrency               = 310;
    // @inject_tag: sql:"payment_live_coin_usd_currency"
    string PaymentLiveUSDCurrency                = 320;

    // orderstate 
    // @inject_tag: sql:"orderstate_id"
    string OrderStateID                          = 330;
    // @inject_tag: sql:"order_state"
    string OrderStateStr                         = 340;
    basetypes.order.v1.OrderState OrderState     = 350;
    // @inject_tag: sql:"end_at"
    uint32 EndAt                                 = 360;
    // @inject_tag: sql:"last_benefit_at"
    uint32 LastBenefitAt                         = 370;
    // @inject_tag: sql:"benefit_state"
    string BenefitStateStr                       = 380;
    basetypes.order.v1.BenefitState BenefitState = 390;
    // @inject_tag: sql:"user_set_paid"
    bool UserSetPaid                             = 400;
    // @inject_tag: sql:"user_set_cancelled"
    bool UserSetCanceled                         = 410;
    // @inject_tag: sql:"payment_transaction_id"
    string PaymentTransactionID                  = 420;
    // @inject_tag: sql:"payment_finish_amount"
    string PaymentFinishAmount                   = 430;
    // @inject_tag: sql:"payment_state"
    string PaymentStateStr                       = 440;
    basetypes.order.v1.PaymentState PaymentState = 450;

    // @inject_tag: sql:"created_at"
    uint32 CreatedAt                             = 1000;
    // @inject_tag: sql:"updated_at"
    uint32 UpdatedAt                             = 1010;
}

message Conds {
    // order
    basetypes.v1.StringVal      ID                    = 10;
    basetypes.v1.StringVal      AppID                 = 20;
    basetypes.v1.StringVal      UserID                = 30;
    basetypes.v1.StringVal      GoodID                = 40;
    basetypes.v1.StringVal      AppGoodID             = 50;
    basetypes.v1.StringVal      ParentOrderID         = 60;
    basetypes.v1.StringVal      PaymentAmount         = 70;
    basetypes.v1.Uint32Val      StartMode             = 80;
    basetypes.v1.Uint32Val      OrderType             = 90;
    basetypes.v1.Uint32Val      InvestmentType        = 100;
    basetypes.v1.StringSliceVal CouponIDs             = 110;
    basetypes.v1.Uint32Val      PaymentType           = 120;
    basetypes.v1.Uint32Val      CreatedAt             = 130;

    // payment
    basetypes.v1.StringVal      PaymentCoinInfoID     = 140;

    // orderstate
    basetypes.v1.Uint32Val      OrderState            = 150;
    basetypes.v1.Uint32Val      LastBenefitAt         = 160;
    basetypes.v1.Uint32Val      BenefitState          = 170;
    basetypes.v1.StringVal      PaymentTransactionID  = 180;
    basetypes.v1.Uint32Val      PaymentState          = 190;

    // other
    basetypes.v1.StringSliceVal IDs                   = 200;
    basetypes.v1.StringVal      CouponID              = 210;
    basetypes.v1.Uint32SliceVal OrderStates           = 220;
}

message CreateOrderRequest {
    OrderReq Info = 10;
}

message CreateOrderResponse {
    Order Info = 10;
}

message CreateOrdersRequest {
    repeated OrderReq Infos = 10;
}

message CreateOrdersResponse {
    repeated Order Infos = 10;
}

message UpdateOrderRequest {
    OrderReq Info = 10;
}

message UpdateOrderResponse {
    Order Info = 10;
}

message UpdateOrdersRequest {
    repeated OrderReq Infos = 10;
}

message UpdateOrdersResponse {
    repeated Order Infos = 10;
}

message GetOrderRequest {
    string ID  = 10;
}

message GetOrderResponse {
    Order Info = 10;
}

message GetOrdersRequest {
    Conds Conds  = 10;
    int32 Offset = 30;
    int32 Limit  = 40;
}

message GetOrdersResponse {
    repeated Order Infos = 10;
    uint32         Total = 20;
}

message GetOrderOnlyRequest {
    Conds Conds  = 10;
}

message GetOrderOnlyResponse {
    Order Info = 10;
}

message CountOrdersRequest {
    Conds Conds  = 10;
}

message CountOrdersResponse {
    uint32 Info = 10;
}

message SumOrderUnitsRequest {
    Conds Conds  = 10;
}

message SumOrderUnitsResponse {
    string Info = 10;
}

message ExistOrderRequest {
    string ID = 10;
}

message ExistOrderResponse {
    bool Info = 10;
}

message ExistOrderCondsRequest {
    Conds Conds = 10;
}

message ExistOrderCondsResponse {
    bool Info = 10;
}

message DeleteOrderRequest {
    OrderReq Info = 10;
}

message DeleteOrderResponse {
    Order Info = 10;
}
