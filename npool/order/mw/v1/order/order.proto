syntax = "proto3";

package order.middleware.order1.v1;

option go_package = "github.com/NpoolPlatform/message/npool/order/mw/v1/order";

import "npool/order/mgr/v1/order/order.proto";
import "npool/order/mgr/v1/payment/payment.proto";
import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "npool/npool.proto";

// Service Name
service Middleware {
    rpc CreateOrder     (CreateOrderRequest)    returns (CreateOrderResponse)    {}
    rpc UpdateOrder     (UpdateOrderRequest)    returns (UpdateOrderResponse)    {}
    rpc GetOrder        (GetOrderRequest)       returns (GetOrderResponse)       {}
    rpc GetOrders       (GetOrdersRequest)      returns (GetOrdersResponse)      {}
    rpc GetOrderOnly    (GetOrderOnlyRequest)   returns (GetOrderOnlyResponse)   {}
}

message OrderReq {
    optional string AppID                     = 10;
    optional string UserID                    = 20;
    optional string GoodID                    = 30;
    optional uint32 Units                     = 40;
    optional order.manager.order.v1.OrderType OrderType = 50;

    optional string ParentOrderID             = 60;
    optional bool   PayWithParent             = 70;

    optional string PaymentCoinID             = 80;
    optional string PayWithBalanceAmount      = 90;
    optional string PaymentAccountID          = 100;
    optional string PaymentAmount             = 110;
    optional string PaymentAccountStartAmount = 120;
    optional string PaymentFinishAmount       = 121;
    optional string PaymentCoinUSDCurrency    = 130;
    optional string PaymentLiveUSDCurrency    = 140;
    optional string PaymentLocalUSDCurrency   = 150;
    optional  order.manager.payment.v1.PaymentState PaymentState = 151;

    optional string FixAmountID               = 160;
    optional string DiscountID                = 170;
    optional string SpecialOfferID            = 180;

    optional uint32 Start                     = 190;
    optional uint32 End                       = 200;

    optional string PromotionID               = 210;

    // Update
    optional string ID                        = 220;
    optional string PaymentID                 = 230;
    optional bool   Canceled                  = 240;
    optional bool   FakePayment               = 250;
    optional order.manager.order.v1.OrderState State  = 260;
}

message Order {
    // @inject_tag: sql:"id"
    string ID                     = 10;
    // @inject_tag: sql:"app_id"
    string AppID                  = 20;
    // @inject_tag: sql:"user_id"
    string UserID                 = 30;
    // @inject_tag: sql:"good_id"
    string GoodID                 = 40;
    // @inject_tag: sql:"units"
    uint32 Units                  = 50;
    // @inject_tag: sql:"type"
    string OrderTypeStr           = 60;
    order.manager.order.v1.OrderType OrderType = 61;
    // @inject_tag: sql:"state"
    string OrderStateStr             = 62;
    order.manager.order.v1.OrderState OrderState = 63;
    // @inject_tag: sql:"parent_order_id"
    string ParentOrderID          = 70;
    // @inject_tag: sql:"parent_order_good_id"
    string ParentOrderGoodID      = 80;
    // @inject_tag: sql:"start_at"
    uint32 Start                  = 90;
    // @inject_tag: sql:"end_at"
    uint32 End                    = 100;

    // @inject_tag: sql:"payment_coin_type_id"
    string PaymentCoinTypeID       = 120;
    // @inject_tag: sql:"payment_coin_usd_currency"
    string PaymentCoinUSDCurrency  = 130;
    // @inject_tag: sql:"payment_local_coin_usd_currency"
    string PaymentLocalUSDCurrency = 140;
    // @inject_tag: sql:"payment_live_coin_usd_currency"
    string PaymentLiveUSDCurrency  = 150;
    // @inject_tag: sql:"payment_id"
    string PaymentID              = 160;
    // @inject_tag: sql:"payment_account_id"
    string PaymentAccountID       = 170;
    // @inject_tag: sql:"payment_amount"
    string PaymentAmount          = 180;
    // @inject_tag: sql:"payment_state"
    string PaymentStateStr        = 190;
    order.manager.payment.v1.PaymentState PaymentState = 191;
    // @inject_tag: sql:"pay_with_balance_amount"
    string PayWithBalanceAmount   = 200;
    // @inject_tag: sql:"paid_at"
    uint32 PaidAt                 = 210;
    // @inject_tag: sql:"payment_start_amount"
    string PaymentStartAmount     = 211;
    // @inject_tag: sql:"payment_finish_amount"
    string PaymentFinishAmount    = 212;

    // @inject_tag: sql:"fix_amount_coupon_id"
    string FixAmountID            = 220;
    // @inject_tag: sql:"discount_coupon_id"
    string DiscountID             = 230;
    // @inject_tag: sql:"user_special_reduction_id"
    string SpecialOfferID         = 240;

    // @inject_tag: sql:"created_at"
    uint32 CreatedAt              = 250;
    // @inject_tag: sql:"user_canceled"
    bool   UserCanceled           = 251;

    // @inject_tag: sql:"pay_with_parent"
    bool   PayWithParent          = 280;
}

message Conds {
    optional npool.v1.StringVal      ID                 = 10;
    optional npool.v1.StringSliceVal IDs                = 20;
    optional npool.v1.StringVal      AppID              = 30;
    optional npool.v1.StringVal      UserID             = 40;
    optional npool.v1.StringVal      CoinTypeID         = 50;
    optional npool.v1.StringVal      ParentOrderID      = 60;
    optional npool.v1.Uint32Val      PaymentState       = 70;
    optional npool.v1.StringVal      PaymentAmount      = 80;
    optional npool.v1.Uint32Val      OrderType          = 90;
    optional npool.v1.Uint32Val      CreatedAt          = 100;
    optional npool.v1.StringVal      GoodID             = 110;
    optional npool.v1.Uint32Val      Type               = 120;
    optional npool.v1.Uint32Val      State              = 130;
    optional npool.v1.StringVal      FixAmountCouponID        = 140;
    optional npool.v1.StringVal      DiscountCouponID         = 150;
    optional npool.v1.StringVal      UserSpecialReductionID   = 160;
}

message CreateOrderRequest {
    OrderReq Info = 10;
}

message CreateOrderResponse {
    Order Info = 10;
}

message UpdateOrderRequest {
    OrderReq Info = 10;
}

message UpdateOrderResponse {
    Order Info = 10;
}

message GetOrderRequest {
    string ID  = 10;
}

message GetOrderResponse {
    Order Info = 10;
}

message GetOrdersRequest {
    Conds Conds  = 10;
    int32 Offset = 30;
    int32 Limit  = 40;
}

message GetOrdersResponse {
    repeated Order Infos = 10;
    uint32         Total = 20;
}

message GetOrderOnlyRequest {
    Conds Conds  = 10;
}

message GetOrderOnlyResponse {
    Order Info = 10;
}
