syntax = "proto3";

package api.manager.v1;

option go_package = "github.com/NpoolPlatform/message/npool/apimgr";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "npool/npool.proto";

service ApiManager {
    rpc Version (google.protobuf.Empty) returns (npool.v1.VersionResponse){
        option (google.api.http) = {
            post: "/version"
            body: "*"
        };
    }

    rpc Register(RegisterRequest) returns (RegisterResponse) {
        option (google.api.http) = {
            post: "/v1/register"
            body: "*"
        };
    }

    rpc GetApis(GetApisRequest) returns (GetApisResponse) {
        option (google.api.http) = {
            post: "/v1/get/apis"
            body: "*"
        };
    }

    rpc GetServiceMethodAPI(GetServiceMethodAPIRequest) returns (GetServiceMethodAPIResponse) {
        option (google.api.http) = {
            post: "/v1/get/service/method/api"
            body: "*"
        };
    }
}

message Path {
    string Method = 10;
    string Path = 20;
    bool Exported = 30;
    string MethodName = 40;
}

message ServiceApis {
    string Protocol = 10;
    string ServiceName = 20;
    string PathPrefix = 30;
    repeated Path Paths = 40;
}

message RegisterRequest {
    ServiceApis Info = 10;
}

message RegisterResponse {
    ServiceApis Info = 10;
}

message ServicePath {
    string ID = 10;
    string Protocol = 20;
    string ServiceName = 30;
    repeated string Domains = 40;
    string PathPrefix = 50;
    string Method = 60;
    string Path = 70;
    bool Exported = 80;
    uint32 CreateAt = 90;
    uint32 UpdateAt = 100;
    string MethodName = 110;
}

message GetApisRequest {
  string ServiceName = 100;
}

message GetApisResponse {
    repeated ServicePath Infos = 10;
}

message GetServiceMethodAPIRequest {
    string ServiceName = 10;
    string MethodName = 20;
}

message GetServiceMethodAPIResponse {
    ServicePath Info = 10;
}

