syntax = "proto3";

package sphinx.v1;

option go_package = "github.com/NpoolPlatform/message/npool/trading";

import "google/api/annotations.proto";
import "npool/signproxy/signproxy.proto";
import "google/protobuf/empty.proto";

// 交易服务
service Trading {
	// 创建账户
	rpc CreateAccount (CreateAccountRequest) returns (CreateAccountResponse) {
		option (google.api.http) = {
			post: "/v1/create/wallet"
			body: "*"
		};}
	// 余额查询
	rpc GetBalance (GetBalanceRequest) returns (GetBalanceResponse) {
		option (google.api.http) = {
			post: "/v1/get/wallet/balance"
			body: "*"
		};}
	// 转账 / 提现
	rpc CreateTransaction (CreateTransactionRequest) returns (CreateTransactionResponse) {
		option (google.api.http) = {
			post: "/v1/create/transaction"
			body: "*"
		};}
	// 交易状态查询
	rpc GetInsiteTxStatus (GetInsiteTxStatusRequest) returns (GetInsiteTxStatusResponse) {
		option (google.api.http) = {
			post: "/v1/get/transaction"
			body: "*"
		};}
	// 接收ack
	rpc ACK (ACKRequest) returns (ACKResponse) {
		option (google.api.http) = {
			post: "/v1/internal/ack"
			body: "*"
		};}
	// ping - pong
  rpc Version (google.protobuf.Empty) returns (VersionResponse){
    option (google.api.http) = {
        post: "/version"
        body: "*"
    };
  }

}

// share account structure
message EntAccount {
	// 币种名称(唯一)
	string CoinName = 1;
	// 钱包地址，创建时填空
	string Address = 3;
}

// CreateAccount 参数
message CreateAccountRequest {
	// 币种名称(唯一)
	string CoinName = 1;
	// 当前取UserID
	string UUID = 2;
}
// CreateAccount 返回
message CreateAccountResponse {
	EntAccount Info = 1;
}

// GetBalance 参数
message GetBalanceRequest {
	EntAccount Info = 1;
}
// GetBalance 返回
message GetBalanceResponse {
	EntAccount Info = 1;
	double AmountFloat64 = 4; // 长整型金额
}

// share transaction structure
message BaseTx {
	// 站内交易ID
	string TransactionIDInsite = 1;
	// 币种名称(唯一)
	string CoinName = 2;
	// 不入库的参考金额
	double AmountFloat64 = 3;
	// 发送方
	string AddressFrom = 4;
	// 接收方
	string AddressTo = 5;
	// sql enum: recharge, payment, withdraw, unknown
	string InsiteTxType = 6;
	// 用户提交请求时的时间戳，与2FA绑定
	int64 CreatetimeUTC = 12;
}

// GetInsiteTxStatus 参数
message GetInsiteTxStatusRequest {
	// 站内交易ID
	string TransactionIDInsite = 1;
}
// GetInsiteTxStatus 返回
message GetInsiteTxStatusResponse {
	BaseTx Info = 1;
	// 上次更新时间
	int64 UpdatetimeUTC = 13;
	// bool, 便于调用方判断
	bool Succeeded = 14;
	// 不success不fail就是pending了
	bool Failed = 15;
	// 公链交易ID（如有）
	string TransactionIDChain = 7;
	// 为done则成功；全部状态："pending_review", "pending_process", "pending_signinfo", "pending_sign", "pending_broadcast", "pending_confirm", "done", "rejected", "error", "error_expected"
	string Status = 8;
}


// CreateTransaction 参数
message CreateTransactionRequest {
	// 交易基本信息
	BaseTx Info = 1;
	// 2FA的时效性验证码，前期可以留空
	string UUIDSignature = 2;
}

// // PortalSignInit 参数
// message PortalSignInit {
// 	int32 coin_id = 1;
// 	string uuid = 2; // 机器标识符
// }

// // PortalWalletInit 参数
// message PortalWalletInit {
// 	int32 coin_id = 1;
// 	string uuid = 2; // 机器标识符
// 	string location = 3; // 硬件所在地点（看板用到的节点信息，下同）
// 	string host_vendor = 4; // 硬件供应商
// 	string mac_address = 5; // MAC地址
// 	string public_ip = 6; // 公网ip，也可能没有
// 	string local_ip = 7; // 内网ip
// 	int64 timestamp_utc = 8; // 汇报时间
// }

message ACKRequest {
	sphinx.proxy.v1.TransactionType transaction_type = 1; // 交易类型： WalletNew, Signature, Balance, PreSign, Broadcast ； 创建账号、查询余额、交易状态更新
	int32 coin_type_id = 2;
	string transaction_id_insite = 3; // 交易ID
	string transaction_id_chain = 4; // 交易链上ID （如有）
	string address = 5; // 创建账号的地址
	double balance = 6; // 查询账号的余额
	bool is_okay = 7; // 交易请求是否成功
	string error_message = 8; // 报错或调试时返回信息
}

message ACKResponse {
	// 是否收到请求
	bool is_okay = 1;
}

message CreateTransactionResponse {
	BaseTx Info = 1;
}

// request body and response
message VersionResponse {
	string Info = 100;
}










