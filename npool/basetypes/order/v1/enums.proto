syntax = "proto3";

package basetypes.order.v1;

option go_package = "github.com/NpoolPlatform/message/npool/basetypes/order/v1";

enum OrderType {
    DefaultOrderType = 0;
    Normal           = 10;
    Offline          = 20;
    Airdrop          = 30;
}

enum OrderState {
    DefaultOrderState = 0;

    OrderStateCreated           = 10; // -> OrderStateWaitPayment

    // Common state
    OrderStateWaitPayment       = 20; // -> OrderStatePaymentTimeout || OrderStatePaymentTransferReceived || OrderStatePreCancel

    // Payment process
    OrderStatePaymentTransferReceived      = 30;  // -> OrderStatePaymentTransferBookKept (bookkeeping)
    OrderStatePaymentTransferBookKeeping   = 40;  // -> OrderStatePaymentBalanceSpent (spend locked balance)
    OrderStatePaymentSpendBalance          = 50;  // -> OrderStateGoodStockTransferred (transfer stock from locked to wait start)
    OrderStateTransferGoodStockLocked      = 60;  // -> OrderStateCommissionAdded (commission added)
    OrderStateAddCommission                = 70; // -> OrderStateAchievementBookKept
    OrderStateAchievementBookKeeping       = 80; // -> OrderStateAchievementBookKept
    OrderStateUpdatePaidChilds             = 90; // -> OrderStatePaid

    // Paid
    OrderStatePaid              = 100;  // -> OrderStatePreCancel || OrderStateTransferGoodStockWaitStart
    OrderStateTransferGoodStockWaitStart = 110; // -> OrderStateUpdatePaidChilds
    OrderStateUpdateInServiceChilds      = 120; // -> OrderStateInService
    OrderStateInService         = 130; // -> OrderStatePreCancel || OrderStatePreExpired

    // Timeout of order
    OrderStatePaymentTimeout    = 140; // -> OrderStatePreCancel


     /*
                           Created
                             |
                             |
                             v
                        WaitPayment----------------------------------------------|
                             |                                    |              |
                             |                                    |              |
                             |                                    |              v
                             v                                    |         PaymentTimeout
                      TransferReceived                            |              |
                             |                                    |              |
                             |                                    |              |
                             v                                    |              |
              |------>TransferBookKeeping                         |              |
              |              |                                    |              |
              |              |                                    |              |
              |              v                                    |              |
        Rollback----->TransferSpendBalance                        |              |
              |              |                                    |
              |              |                                    |
              |              v                                    |
        Rollback---->TransferGoodStockLocked                      |
              |              |                                    |
              |              |                                    |
              |              v                                    |
        Rollback------>AddCommission                              |
              |              |                                    |
              |              |                                    |
              |              v                                    |
        Rollback----->AchievementBookKeeping                      |
              |              |                                    |
              |              |                                    |
              |              v                                    |
        Rollback----->AchievementBookKept                         |
              |              |                                    |
              |              |                                    |
              |              v                                    |
        Rollback------------Paid----------------------------------|
                             |                                    |
                             |                                    |
                             v                                    |
        |------>TransferGoodStockWaitStart                        |
        |                    |                                    |
        |                    |                                    |
        |                    v                                    |
        --------------- InService---------------------------------|
                             |                                    |
                             |                                    |
                             v                                    |
              |----> TransferGoodStockInService                   |
              |              |                                    |
              |              |                                    |
              |              v                                    v
              ----------->PreExpired                         PreCancel<----------------------------
              |              |                                    |                               |
              |              |                                    |                               |
              |              v                                    v                               |
        Rollback----->RestoreExpiredStock                 RestoreCanceledStock<----------------Rollback
              |              |                                    |                               |
              |              |                                    |                               |
              |              v                                    v                               |
        Rollback----------Expired                          CanceledAchievement<---------------Rollback
                                                                  |                               |
                                                                  |                               |
                                                                  v                               |
                                                          ReturnCanceledBalance<---------------Rollback
                                                                  |                               |
                                                                  |                               |
                                                                  v                               |
                                                               Canceled------------------------Rollback
     *
     */

    // End or order
    OrderStatePreCancel         = 150; // -> OrderStateRestoreCanceledStock
    OrderStatePreExpired        = 160; // -> OrderStateRestoreExpiredStock

    // Calculation
    OrderStateRestoreExpiredStock   = 170; // -> OrderStateExpired
    OrderStateUpdateExpiredChilds   = 180; // -> OrderStatePreExpired
    OrderStateRestoreCanceledStock  = 190; // -> OrderStateCancelAchievement
    OrderStateCancelAchievement     = 200; // -> OrderStateDeductLockedCommission
    OrderStateDeductLockedCommission = 210; // -> OrderStateReturnCanceledBalance
    OrderStateReturnCanceledBalance = 220; // -> OrderStateCanceled
    OrderStateUpdateCanceledChilds  = 230; // -> OrderStatePreExpired

    // End state
    OrderStateCanceled          = 240;
    OrderStateExpired           = 250;

    // Delivery order state
}

enum PaymentState {
    DefaultPaymentState   = 0;

    PaymentStateWait      = 10;
    PaymentStateDone      = 20;
    PaymentStateCanceled  = 30;
    PaymentStateTimeout   = 40;

    PaymentStateNoPayment = 1000;
}

enum InvestmentType {
    DefaultInvestmentType = 0;

    UnionMining = 10;
    FullPayment = 20;
}

enum PaymentType {
    DefaultPaymentType = 0;

    PayWithBalanceOnly        = 10;
    PayWithTransferOnly       = 20;
    PayWithTransferAndBalance = 30;
    PayWithParentOrder        = 40;

    PayWithOffline            = 1000;
    PayWithNoPayment          = 1010;
}

enum CompensateType {
    DefaultCompensateType = 0;

    CompensateMalfunction  = 10;
    CompensateWalfare      = 20;
    CompensateStarterDelay = 30;
}

enum BenefitState {
    DefaultBenefitState = 0;

    BenefitWait       = 10;
    BenefitCalculated = 20;
    BenefitBookKept   = 30;
}

enum OrderStartMode {
    DefaultOrderStartMode = 0;

    OrderStartTBD        = 10;
    OrderStartConfirmed  = 20;
}

enum OrderLockType {
    DefaultOrderLockType = 0;

    LockBalance    = 10;
    LockStock      = 20;
    LockCommission = 30;
}
