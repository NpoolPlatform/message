syntax = "proto3";

package basetypes.order.v1;

option go_package = "github.com/NpoolPlatform/message/npool/basetypes/order/v1";

enum OrderType {
    DefaultOrderType = 0;
    Normal           = 10;
    Offline          = 20;
    Airdrop          = 30;
}

enum OrderState {
    DefaultOrderState = 0;

    // Common state
    OrderStateWaitPayment       = 10; // -> OrderStateCheckPayment
    OrderStateCheckPayment      = 20; // -> OrderStatePaymentTimeout || PaymentTransferReceived

    // Payment process
    OrderStatePaymentTransferReceived      = 30;  // -> OrderStatePaymentTransferReceivedCheck (received on blockchain)
    OrderStatePaymentTransferReceivedCheck = 40;  // -> OrderStatePaymentTransferBookKept (bookkeeping)
    OrderStatePaymentTransferBookKept      = 50;  // -> OrderStatePaymentTransferBookKeptCheck
    OrderStatePaymentTransferBookKeptCheck = 60;  // -> OrderStatePaymentBalanceSpent (spend locked balance)
    OrderStatePaymentBalanceSpent          = 70;  // -> OrderStatePaymentBalanceSpentCheck
    OrderStatePaymentBalanceSpentCheck     = 80;  // -> OrderStateGoodStockTransferred (transfer stock from locked to wait start)
    OrderStateGoodStockTransferred         = 90;  // -> OrderStateGoodStockTransferredCheck
    OrderStateGoodStockTransferredCheck    = 100; // -> OrderStateAchievementBookKept (bookkeep purchase achievement)
    OrderStateAchievementBookKept          = 110; // -> OrderStateAchievementBookKeptCheck
    OrderStateAchievementBookKeptCheck     = 120; // -> OrderStatePaid

    // Paid
    OrderStatePaid              = 90;
    OrderStateInService         = 100;

    // Timeout of order
    OrderStatePaymentTimeout    = 110; // -> OrderStatePreCancel


     /**
     *
     *                   WaitPayment
     *                        |
     *                        |
     *                        v
     *                   CheckPayment---------------------------------------------|
     *                        |                                    |              |
     *                        |                                    |              |
     *                        v                                    |              v
     *                 TransferReceived                            |         PaymentTimeout
     *                        |                                    |              |
     *                        |                                    |              |
     *                        v                                    |              |
     *         ------->TransferReceivedCheck                       |              |
     *         |              |                                    |              |
     *         |              |                                    |              |
     *         |              v                                    |              |
     *   Rollback------TransferBookKept                            |              |
     *                        |                                    |              |
     *                        |                                    |              |
     *                        v                                    |              |
     *         ----->TransferBookKeptCheck                         |              |
     *         |              |                                    |              |
     *         |              |                                    |              |
     *         |              v                                    |              |
     *   Rollback---------BalanceSpent                             |              |
     *                        |                                    |              |
     *                        |                                    |              |
     *                        v                                    |              |
     *         ------->BalanceSpentCheck                           |<--------------
     *         |              |                                    |
     *         |              |                                    |
     *         |              v                                    |
     *   Rollback------------Paid----------------------------------|
     *                        |                                    |
     *                        |                                    |
     *                        v                                    |
     *                   InService---------------------------------|
     *                        |                                    |
     *                        |                                    |              
     *                        v                                    v              
     *                   PreExpired                            PreCancel
     *                        |                                    |             
     *                        |                                    |     
     *                        v                                    v                               
     *         ------->PreExpiredCheck                        PreCancelCheck<-----------------------
     *         |              |                                    |                               |
     *         |              |                                    |                               |
     *         |              v                                    v                               |
     *   Rollback------RestoreExpiredStock                 RestoreCanceledStock-----------------Rollback
     *                        |                                    |                              
     *                        |                                    |     
     *                        v                                    v                               
     *         ------->RestoreExpiredStockCheck            RestoreCanceledStockCheck<---------------
     *         |              |                                    |                               |
     *         |              |                                    |                               |
     *         |              v                                    v                               |
     *   Rollback----------Expired                         ReturnCanceledBalance----------------Rollback
     *                                                             |                              
     *                                                             |     
     *                                                             v                               
     *                                                     ReturnCanceledBalanceCheck<--------------
     *                                                             |                               |
     *                                                             |                               |
     *                                                             v                               |
     *                                                          Canceled------------------------Rollback
     *
     */

    // End or order
    OrderStatePreCancel         = 120; // -> OrderStatePreCancelCheck
    OrderStatePreCancelCheck    = 130; // -> OrderStateRestoreCanceledStock
    OrderStatePreExpired        = 140; // -> OrderStatePreExpired
    OrderStatePreExpiredCheck   = 150; // -> OrderStateRestoreExpiredStock

    // Calculation
    OrderStateRestoreExpiredStock        = 160; // -> OrderStateRestoreExpiredStockCheck
    OrderStateRestoreExpiredStockCheck   = 170; // -> OrderStateExpired
    OrderStateRestoreCanceledStock       = 180; // -> OrderStateRestoreCanceledStockCheck
    OrderStateRestoreCanceledStockCheck  = 190; // -> OrderStateReturnCanceledBalance
    OrderStateReturnCanceledBalance      = 200; // -> OrderStateReturnCanceledBalanceCheck
    OrderStateReturnCanceledBalanceCheck = 210; // -> OrderStateCanceled

    // End state
    OrderStateCanceled          = 220;
    OrderStateExpired           = 230;

    // Delivery order state
}

enum PaymentState {
    DefaultPaymentState   = 0;

    PaymentStateWait      = 10;
    PaymentStateDone      = 20;
    PaymentStateCanceled  = 30;
    PaymentStateTimeout   = 40;

    PaymentStateNoPayment = 1000;
}

enum InvestmentType {
    DefaultInvestmentType = 0;

    UnionMining = 10;
    FullPayment = 20;
}

enum PaymentType {
    DefaultPaymentType = 0;

    PayWithBalanceOnly        = 10;
    PayWithTransferOnly       = 20;
    PayWithTransferAndBalance = 30;
    PayWithParentOrder        = 40;

    PayWithOffline            = 1000;
    PayWithNoPayment          = 1010;
}

enum CompensateType {
    DefaultCompensateType = 0;

    CompensateMalfunction  = 10;
    CompensateWalfare      = 20;
    CompensateStarterDelay = 30;
}

enum BenefitState {
    DefaultBenefitState = 0;

    BenefitWait       = 10;
    BenefitCalculated = 20;
    BenefitDone       = 30;
}

enum OrderStartMode {
    DefaultOrderStartMode = 0;

    OrderStartTBD        = 10;
    OrderStartConfirmed  = 20;
}
