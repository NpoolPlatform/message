syntax = "proto3";

package sphinx.proxy.v1;

option go_package = "github.com/NpoolPlatform/message/npool/signproxy";

import "npool/sphinxplugin/sphinxplugin.proto";

// TODO 分开 sign 和 proxy 的队列
// Service Name
service SignProxy {
    rpc ProxyPlugin (stream ProxyPluginResponse) returns (stream ProxyPluginRequest) {}
    rpc ProxySign (stream ProxySignResponse) returns (stream ProxySignRequest) {}
}

// RegisterCoin ..
message ProxyPluginResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    uint64 Nonce                                = 120;
    string CID                                  = 130;
    string Balance                              = 140;
}

// MpoolGetNonce WalletBalance MpoolPush ..
message ProxyPluginRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    string Address                              = 120;
    sphinx.plugin.v1.UnsignedMessage Message    = 130;
    sphinx.plugin.v1.Signature       Signature  = 140;
}

// Sign WalletNew ..
message ProxySignRequest {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    sphinx.plugin.v1.UnsignedMessage Message    = 130;
}

message ProxySignResponse {
    sphinx.plugin.v1.CoinType CoinType          = 100;
    TransactionType TransactionType             = 110;
    ProxySignResponseInfo Info                  = 120;
}

message ProxySignResponseInfo {
    string Address                              = 100;// create new account address
    sphinx.plugin.v1.UnsignedMessage Message    = 110;
	sphinx.plugin.v1.Signature       Signature  = 120;
}

enum TransactionType {
    Invalid         = 0;
    WalletNew       = 1; // proxy -> sign
    Signature       = 2; // proxy -> sign
    Balance         = 3; // proxy -> plugin
    PreSign         = 4; // proxy -> pluign get nonce
    Broadcast       = 5; // proxy -> plugin mpool push
    RegisterCoin    = 6; // plugin -> proxy
}
